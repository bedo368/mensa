"use strict";(()=>{var e={};e.id=760,e.ids=[760],e.modules={6037:e=>{e.exports=require("mongoose")},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9021:e=>{e.exports=require("fs")},8932:e=>{e.exports=import("firebase/app")},2537:e=>{e.exports=import("firebase/storage")},7313:e=>{e.exports=import("formidable")},9829:e=>{e.exports=import("nanoid")},6762:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},2082:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{config:()=>d,default:()=>l,routeModule:()=>c});var i=r(9947),o=r(325),a=r(6762),s=r(3320),u=e([s]);s=(u.then?(await u)():u)[0];let l=(0,a.M)(s,"default"),d=(0,a.M)(s,"config"),c=new i.PagesAPIRouteModule({definition:{kind:o.A.PAGES_API,page:"/api/new-test",pathname:"/api/new-test",bundlePath:"",filename:""},userland:s});n()}catch(e){n(e)}})},7819:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(6037),i=r.n(n);let o=new(i()).Schema({question:String,options:[String],correctAnswer:Number,image:String}),a=new(i()).Schema({title:{type:String,required:!0},description:{type:String,required:!0},questions:[o],questionCount:{type:Number,required:!0},difficulty:{type:String,enum:["easy","medium","hard"],required:!0},totalMarks:{type:Number,required:!0},timeLimit:{type:Number,required:!0,default:60},createdAt:{type:Date,default:Date.now}}),s=i().models.Test||i().model("Test",a)},4622:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(6037),i=r.n(n);let o="mongodb+srv://user:JUeucc905NPw0B9b@cluster0.qjvmb.mongodb.net/";if(!o)throw Error("يرجى إعداد متغير البيئة MONGODB_URI في ملف .env.local");let a=global.mongoose;a||(a=global.mongoose={conn:null,promise:null});let s=async function(){return a.conn||(a.promise||(a.promise=i().connect(o,{bufferCommands:!1}).then(e=>e)),a.conn=await a.promise),a.conn}},1899:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{I:()=>u});var i=r(8932),o=r(2537),a=e([i,o]);[i,o]=a.then?(await a)():a;let s=(0,i.initializeApp)({apiKey:"AIzaSyB4MGJ4C_zGIXAGO5GePG1wm0i3WS3prHA",authDomain:"on-the-bon-1.firebaseapp.com",projectId:"on-the-bon-1",storageBucket:"on-the-bon-1.appspot.com",messagingSenderId:"381399143885",appId:"1:381399143885:web:84d297d6fead8f12dd6084",measurementId:"G-YZ9LDQYQHV"}),u=(0,o.getStorage)(s);n()}catch(e){n(e)}})},3320:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{config:()=>f,default:()=>m});var i=r(2537),o=r(9829),a=r(4622),s=r(1899),u=r(7819),l=r(7313),d=r(9021),c=r.n(d),p=e([i,o,s,l]);[i,o,s,l]=p.then?(await p)():p;let f={api:{bodyParser:!1}};async function m(e,t){if(await (0,a.A)(),"POST"===e.method){let r=(0,l.default)({multiples:!0,keepExtensions:!0});try{r.parse(e,async(e,r,n)=>{let a;if(e)return console.error("Error parsing form-data:",e),t.status(400).json({error:"Error parsing form-data"});let l=Array.isArray(r.title)?r.title[0]:r.title,d=Array.isArray(r.description)?r.description[0]:r.description,p=Array.isArray(r.questions)?r.questions[0]:r.questions;if(!l||!d||!p)return t.status(400).json({error:"Title, description, and questions are required"});try{a=JSON.parse(p)}catch(e){return console.error("Error parsing questions JSON:",e),t.status(400).json({error:"Invalid questions JSON"})}let m=await Promise.all(a.map(async e=>{if(!e.image||!n[e.image])return e;let t=n[e.image];if(!Array.isArray(t)||0===t.length)return console.error(`File is missing or invalid for ${e.image}`),e;let r=t[0],a=`question-${(0,o.nanoid)()}.jpg`,u=(0,i.ref)(s.I,`tests/${a}`),l=c().readFileSync(r.filepath);await (0,i.uploadBytes)(u,l);let d=await (0,i.getDownloadURL)(u);return{...e,image:d}})),f=new u.A({title:l,description:d,questions:m,questionCount:m.length,difficulty:"medium",totalMarks:m.length,timeLimit:60,createdAt:new Date});await f.save(),t.status(201).json({message:"Test created successfully!"})})}catch(e){console.error("Error while handling the request:",e),t.status(500).json({error:"An internal server error occurred."})}}else t.setHeader("Allow",["POST"]),t.status(405).json({error:"Method not allowed"})}n()}catch(e){n(e)}})},325:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},9947:(e,t,r)=>{e.exports=r(5600)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=2082);module.exports=r})();